const SongSheet = {
  1: [
    {time: 1.65, noteID: 1},
    {time: 2.2, noteID: 2},
    {time: 2.75, noteID: 1},
    {time: 3.3, noteID: 2},
    {time: 3.85, noteID: 1},
    {time: 4.125, noteID: 1},
    {time: 4.4, noteID: 3},
    {time: 4.95, noteID: 1},
    {time: 5.5, noteID: 2},
    {time: 6.05, noteID: 1},
    {time: 6.6, noteID: 2},
    {time: 7.7, noteID: 4},
    {time: 8.8, noteID: 1},
    {time: 9.35, noteID: 2},
    {time: 9.9, noteID: 1},
    {time: 10.45, noteID: 2},
    {time: 11, noteID: 3},
    {time: 12.1, noteID: 1},
    {time: 12.6, noteID: 2},
    {time: 13.15, noteID: 1},
    {time: 14.25, noteID: 1},
    {time: 14.8, noteID: 2},
    {time: 15.35, noteID: 1},
    {time: 16.45, noteID: 3},
    {time: 17, noteID: 3},
  ],
  2: [
    {time: 1.72, noteID: 1},
    {time: 2.16, noteID: 2},
    {time: 2.8, noteID: 1},
    {time: 3.24, noteID: 2},

    {time: 3.88, noteID: 1}, //78
    {time: 4.32, noteID: 2},
    {time: 4.96, noteID: 1}, //86
    {time: 5.4, noteID: 2},
    {time: 6.04, noteID: 1}, //94
    {time: 6.48, noteID: 2},

    {time: 7.02, noteID: 3},
    {time: 7.56, noteID: 3},

    // {time: 8.1, noteID: 1},
    // {time: 8.64, noteID: 2},
    // {time: 9.18, noteID: 1},
    {time: 9.72, noteID: 1},
    {time: 10.26, noteID: 1},
    {time: 10.8, noteID: 2},
    {time: 11.34, noteID: 3},
    {time: 11.88, noteID: 3},

    {time: 12.42, noteID: 1},
    {time: 12.96, noteID: 2},
    {time: 13.5, noteID: 3},
    {time: 14.04, noteID: 3},

    {time: 14.58, noteID: 1},
    {time: 15.12, noteID: 2},
    {time: 15.66, noteID: 3},
    {time: 16.2, noteID: 3},

    {time: 16.74, noteID: 4},
    {time: 17.28, noteID: 4},
    {time: 17.82, noteID: 4},
    {time: 18.36, noteID: 4},


    {time: 19.44, noteID: 1},
    {time: 19.98, noteID: 1},
    {time: 20.52, noteID: 1},

    // {time: 21.06, noteID: 2},
    // {time: 21.6, noteID: 3},

    // {time: 22.14, noteID: 1},
    {time: 22.6, noteID: 1}, //68
    {time: 23.14, noteID: 1}, //22
    {time: 23.66, noteID: 2}, //76

    // {time: 24.3, noteID: 1},
    {time: 24.76, noteID: 1}, //84
    {time: 25.30, noteID: 1}, //38
    {time: 25.82, noteID: 2}, //92

    // {time: 26.46, noteID: 1},
    {time: 26.92, noteID: 1}, //27.0
    {time: 27.45, noteID: 1}, //54
    {time: 27.98, noteID: 2}, //08

    // {time: 28.62, noteID: 1},
    {time: 28.9, noteID: 4}, //16
    // {time: 29.7, noteID: 1},
    {time: 29.98, noteID: 4}, //24



    // {time: 30.78, noteID: 1},
    {time: 31.32, noteID: 3},
    {time: 31.86, noteID: 2},
    {time: 32.13, noteID: 1},
    {time: 32.4, noteID: 1},

    // {time: 32.94, noteID: 1},
    {time: 33.48, noteID: 1},
    {time: 34.02, noteID: 1},
    {time: 34.36, noteID: 2},

    // {time: 35.1, noteID: 1},

    // {time: 35.64, noteID: 1},
    // {time: 36.18, noteID: 1},
    // {time: 36.72, noteID: 2},

    // still ok
    // {time: 37.26, noteID: 4},
    // {time: 37.8, noteID: 3},
    // {time: 38.34, noteID: 2},
    // {time: 38.88, noteID: 1},


    // {time: 37.25, noteID: },


    // {time: 37.55, noteID: 4},
    // {time: 37.8, noteID: 3},
    // {time: 38.05, noteID: 2},
    // {time: 38.3, noteID: 1},
    // {time: 38.55, noteID: 2},
    // {time: 38.85, noteID: 1},
    // {time: 39.15, noteID: 1},

    {time: 37.45, noteID: 4},
    {time: 37.7, noteID: 3},
    {time: 37.95, noteID: 2},
    {time: 38.2, noteID: 1},
    {time: 38.45, noteID: 2},
    {time: 38.75, noteID: 1},
    {time: 39.05, noteID: 1},

    // {time: 39.42, noteID: 1},
    // {time: 39.96, noteID: 1},
    // {time: 40.5, noteID: 1},
    // {time: 41.04, noteID: 2},

    {time: 41.58, noteID: 3},
    {time: 42.12, noteID: 2},
    {time: 42.66, noteID: 1},
    {time: 43.2, noteID: 2},

    // {time: 43.74, noteID: 1},
    {time: 44.28, noteID: 1},
    {time: 44.82, noteID: 1},
    {time: 45.36, noteID: 2},

    // {time: 45.9, noteID: 1},
    {time: 46.44, noteID: 1},
    {time: 46.98, noteID: 1},
    {time: 47.52, noteID: 2},

    // {time: 48.06, noteID: 1},
    {time: 48.5, noteID: 1}, //6
    {time: 49.04, noteID: 1},//14
    {time: 49.58, noteID: 3},//68

    // {time: 50.22, noteID: 1},
    {time: 50.66, noteID: 4},
    // {time: 51.3, noteID: 1},
    {time: 51.74, noteID: 4},

    // {time: 52.38, noteID: 1},
    {time: 52.8, noteID: 1}, //92
    {time: 53.32, noteID: 2}, //46
    {time: 53.88, noteID: 1}, //54

    // {time: 54.54, noteID: 1},
    {time: 54.84, noteID: 3}, //08
    {time: 55.38, noteID: 3},//62
    {time: 55.92, noteID: 2},//16

    // {time: 56.7, noteID: 2},
    {time: 57, noteID: 2},//24
    {time: 57.54, noteID: 2},//78
    {time: 58.08, noteID: 1},//32

    {time: 58.86, noteID: 2},
    {time: 59.1, noteID: 1},
    {time: 59.37, noteID: 3},
    {time: 59.64, noteID: 2},
    {time: 60.2, noteID: 4},

  ]
}

const StreakBar = require('./streak_bar')

class Sheet {
  constructor(note, feedback, stage, songID){
    this.streakBar = new StreakBar(stage)
    this.note = note;
    this.feedback = feedback;
    this.stage = stage;
    this.song = SongSheet[songID];
    this.i = 0;
    this.j = 0;
    this.currentTime = 0;
    this.score = 0;
    this.correctStrike = this.correctStrike.bind(this);
    this.wrongStrike = this.wrongStrike.bind(this);
    this.renderStrike = this.renderStrike.bind(this);
    this.play = this.play.bind(this);
    this.setCurrentTime = this.setCurrentTime.bind(this);
  }

  setCurrentTime(currentTime){
    this.currentTime = currentTime;
    if (this.j < this.song.length) {
      if ((this.currentTime) > (this.song[this.j].time +0.1)){
        this.j += 1;
      }
    }
  }

  play(){
    if (this.i < this.song.length) {
      if (this.currentTime > (this.song[this.i].time - 1.5) ){
        this.note.scroll(this.song[this.i].noteID)
        this.i += 1;
      }
    }
  }

  correctStrike(noteID){
    this.score += 1;
    $("#score").html(this.score)
    this.streakBar.plus()

    this.renderStrike(noteID, "black");

    // if (this.streak === 5) this.feedback.streak("5 pt streak!");
    // if (this.streak === 15) this.feedback.streak("15 pt streak!");
    // if (this.streak === 25) this.feedback.perfect();
  }

  wrongStrike(noteID){
    this.streakBar.clear();

    let noFx = new Audio();
    noFx.src = "./assets/sounds/no_fx.mp3";
    noFx.volume = .2;
    noFx.play();

    this.renderStrike(noteID, "red");
  }

  renderStrike(noteID, color){
    let xCoord = this.note.note[noteID].xCoord
    var strikeNote = new createjs.Shape();
    strikeNote.graphics.beginFill(color)
                   .drawEllipse((xCoord - 2), 348, 29, 24)
    this.stage.addChild(strikeNote);

    strikeNote.alpha = (color === "red") ? 0.55 : .35;
    setTimeout(()=>this.stage.removeChild(strikeNote), 130)
  }

  strike(noteID){
    if(this.currentTime < (this.song[this.j].time+ 0.1)
    && this.currentTime > (this.song[this.j].time - 0.1)
    && noteID === this.song[this.j].noteID){
      this.correctStrike(noteID)
    }else{
      this.wrongStrike(noteID)
    }
  }

  reset(){
    this.i = 0;
    this.j = 0;
    this.score = 0;
    this.streakBar.clear()
    $("#score").html(0)
  }
}

module.exports = Sheet;
